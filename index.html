<!DOCTYPE html>
<html>
<head>
	<title> Smart Mail Hack 700k</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<style>
		body {
			margin: 0;
			padding: 0;
			border: none;
		}
		.smh-main {
			height: 100vh;
			width: 100vw;
			/*border: 1px solid red;*/
			border: none;
			margin: 0;
			padding: 0;
		}
		.smh-header {
			height: 52px;
/*			width: 100vw;
			padding-left: 32px;
			padding-right: 32px;
*/			background-color: #178de2;
		}

		.smh-header-menu {
/*			width: 60%;
			display: inline-block;
*/		}
		.smh-header-search {
/*			width: 30%;
			float: right;
*/			/*border: 1px solid red;*/
			/*display: inline-block;*/
		}

	</style>
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css" integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4" crossorigin="anonymous">
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
	<script>
		const sendMessageUrl = 'http://localhost:8080/send_message'
		let files = []
		function onFileFieldChange(el) {
			console.log('this is:', el)

			for (let item of Array.from(el.files)) {
				files.push(item)

				drawFile(item)
			}
			el.value = null
		}

		function drawFile(file) {
			let parent = document.querySelector('.attachments-container')
			let child = document.createElement('i')
			child.classList.add('fa', 'fa-file')
			child.style['font-size'] = '42pt'
			child.style['margin'] = '5px'
			parent.appendChild(child)
		}

		function openMessageWindow(button) {
			document.querySelector('.smh-contant-main').style.display = 'none'
			document.querySelector('.smh-message').style.display = 'inline'

		}

		function closeMessageWindow() {
			console.log('on close!')
			document.querySelector('.smh-contant-main').style.display = 'inline'
			document.querySelector('.smh-message').style.display = 'none'

			let attachmentsContainer = document.querySelector('.attachments-container')
			while (attachmentsContainer.firstChild) {
				attachmentsContainer.removeChild(attachmentsContainer.firstChild);
			}
		}

		function sendForm(form) {
			console.log('send form!', form)
			let formData = new FormData()
			for (let i in files) {
				formData.append('attach' + i, files[i])
			}

			formData.append('body', JSON.stringify({
			    "correspondents": {
			        "to": document.querySelector('input[name=email]').value
			    },
			    "body": {
			        "html": document.querySelector('textarea[name=text]').value,
			        "text": document.querySelector('textarea[name=text]').value
			    }
			}))

			var xhr = new XMLHttpRequest();
			xhr.open('POST', sendMessageUrl, true)
			xhr.onload = function(e) { 
				console.log('year!!!')
			}

			xhr.send(formData)
			console.log('after send here!')
		}
	</script>
</head>
<body>
	<div class="smh-main">
		<div class="row smh-header">
			<div class="smh-header-menu col-md-7">
					<img src="mail.jpg" alt="Girl in a jacket" style="width:36px;height:42px;">
					<input type="text" placeholder="Search.." style="font-size:30px;"> 


			</div>
			<div class="smh-header-search col-md-5 ">





			 </div>
		</div>
		<div class="row smh-contant-main">
			<div class="col-md-12">
				<button onclick="openMessageWindow(this)"> Отправить </button>
			</div>
		</div>

		<div class="row smh-message" style="display: inline;">
			<div class="col-md-12">
				<form id="oneform" name="myform" action="#">
					<input type="text" name="email" value="smartmail_team26@mail.ru">
					<!-- <input type="number" name="id" value="123456"> -->
					<label for="attach-input"> Test <i class="fa fa-paperclip"></i> </label>
					<textarea name="text"></textarea>
	
					<input type="submit" onclick="event.preventDefault(); return sendForm(this.form);">
					<label for="close-input"> Закрыть все нахрен! </label>
					<input id="close-input" type="text" hidden onclick="closeMessageWindow()">
				</form>
				<input id="attach-input" name="file" type="file" hidden onchange="onFileFieldChange(this)" multiple>
				<div class="attachments-container col-md-12">
					
				</div>
			</div>	
		</div>
	</div>
	
</body>
</html>
